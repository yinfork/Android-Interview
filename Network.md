## 计算机网络
<span id = "home"></span>
#### 目录
1. [协议体系模型](#network_arch)
2. [物理层](#network_physical_layer)
3. [数据链路层](#network_data_link_layer)
4. [网络层](#network_network_layer)
5. [运输层](#network_transport_layer)
6. [应用层](#network_application_layer)

----

<span id = "network_arch"></span>
#### 协议体系模型 [(TOP)](#home)
![](https://github.com/yinfork/Android-Interview/blob/master/res/network/network_arch.png?raw=true)

----

<span id = "network_physical_layer"></span>
#### 物理层 [(TOP)](#home)
1. 概述
	1. 作用<br>
		**物理层(physical layer)的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。**
	
	2. 细节<br>
		使其上面的数据链路层不必考虑网络的具体传输介质是什么。“透明传送比特流”表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。<br>
	
	3. 数据单位<br>
		在物理层上所传送的数据单位是比特。

2. 传输方向的工作方式
	1. 单工：只能有一个方向的通信而没有反方向的交互。
	2. 半双工：通信的双方都可以发送信息，但不能双方同时发送(当然也就不能同时接收)。
	3. 全双工：通信的双方可以同时发送和接收信息。

3. 信号
	1. 基带信号<br>
		来自信源的信号。指没有经过调制的数字信号或模拟信号。
		1. 曼彻斯特编码信号<br>
			每个原始信号码元固定用两个连续极性相反的脉冲来表示,1码用正、负电平表示(也就是先正后负,对应的编码为10)，0码用负、正电平表示(也就是先负后正,对应的编码为01)。其关键特点就是在每个码元的1/2码元位置必须进行极性跳变
			1. 优点: **每一位的中间有一跳变，位中间的跳变既作时钟信号，又作数据信号，所以具有自同步能力和良好的抗干扰性能。**
			2. 缺点: 每一个码元都被调成两个电平，所以编码效率50%
			
		2. 差分曼彻斯特编码<br>
			编码规则：对于二进制信号中的第一个码元与曼彻斯特的转换方式一样，都是在1/2码元时进行电平极性跳变,即把0码转换成01码,把1码转换成10码；后面的信号码就根据以下两条规则跳变：如果本码为1,开始处的电平不跳变；如果本码为0,开始处的电平必须跳变。<br>
			**相比曼彻斯特编码，可以解决当极性反转时引起的译码错误。**
			1. 优点: 收发双方可以根据编码自带的时钟信号来保持同步，无需专门传递同步信号的线路
			2. 缺点: 每一个码元都被调成两个电平，所以编码效率50%

		3. 不归零码<br>
			信号电平由0、1表示，并且在表示完一个码元后，电压不需回到0	。常见有CMI码
			
		4. 例子<br>
			![](https://github.com/yinfork/Android-Interview/blob/master/res/network/manchester_encoding.jpg?raw=true)
			
	2. 宽带信号<br>
		指将基带信号调制后形成频分复用模拟信号。

4. 物理层之下的传输媒体
	1. 双绞线
	2. 同轴电缆
	3. 光缆		

5. 信道复用技术<br>
	通信线路的架设费用较高，需要尽可能地充分使用每个信道的容量，尽可能不重复建设通信线路
	1. 频分复用FDM<br>
		ADSL技术采用频分复用技术把普通的电话线分成了电话、上行和下行三个相对独立的信道，从而避免了相互之间的干扰。用户可以边打电话边上网，不用担心上网速率和通话质量下降的情况。
	2. 时分复用TDM
	3. 码分多址CDMA：每个用户可以在同样的时间使用同样的频带进行通信。

6. 调制器和解调器
	1. 调制器：基带数字信号波形转为模拟信号的波形
	2. 解调器：将经过调制器变换的模拟信号恢复成原来的数字信号

7. 常用单位
	1. 带宽（bandwidth）<br>
		在计算机网络中，表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”。常用来表示网络的通信线路所能传送数据的能力。单位是“比特每秒”，记为b/s。
	2. 码元（code）<br>
		在使用时间域（或简称为时域）的波形来表示数字信号时，代表不同离散数值的基本波形。
	3. 信噪比（signal-to-noise ratio ）<br>
		指信号的平均功率和噪声的平均功率之比，记为S/N。信噪比（dB）=10*log10（S/N）
	4. 比特率（bit rate ）
		单位时间（每秒）内传送的比特数。

8. 定理
	1. 奈氏准则<br>
		理想低通信道最高码元传输速率 = 2W Baud（即每赫兹理想低通信道最高码元传输速率每秒2个码元）		
	2. 香农定理<br>
		信道的极限传输速率C = Wlog2(1+S/N)，W为带宽，S为平均功率，N为高斯噪声功率，S/N也称为信噪比
	3. 采样定理<br>	
		只要采样频率不低于电话信号最高频率的2倍，就可以从采样脉冲信号无失真地恢复出原来的电话信号。

9. 参考
	1. 	https://zhuanlan.zhihu.com/p/52248268
	2. https://github.com/Snailclimb/JavaGuide/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%8E%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.md#%E5%85%AB-http%E9%95%BF%E8%BF%9E%E6%8E%A5%E3%80%81%E7%9F%AD%E8%BF%9E%E6%8E%A5
	3. https://github.com/it-interview/EasyJob/blob/master/Network/network.md
	4. https://github.com/Snailclimb/JavaGuide/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%8E%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/%E5%B9%B2%E8%B4%A7%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93.md

----

<span id = "network_data_link_layer"></span>
#### 数据链路层 [(TOP)](#home)
1. 概述<br>
	1. 作用<br>
		**在原始的、有差错的物理传输线路的基础上，采取差错检测，差错控制和流量控制等方法，将有差错的物理线路改进成逻辑上的无差错的数据链路，以便向他的上一层网络层提供透明可靠的数据传输服务。**
	
	2. 细节<br>
		在接收数据时，控制信息使接收端能够知道一个帧从哪个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可从中提出数据部分，上交给网络层。 控制信息还使接收端能够检测到所收到的帧中有误差错。如果发现差错，数据链路层就简单地丢弃这个出了差错的帧，以避免继续在网络中传送下去白白浪费网络资源。如果需要改正数据在链路层传输时出现差错（这就是说，数据链路层不仅要检错，而且还要纠错），那么就要采用可靠性传输协议来纠正出现的差错。这种方法会使链路层的协议复杂些。
	3. 数据单位<br>
		数据链路层传输的协议数据单元是帧
	
	4. 为什么要封装成帧<br>
		物理层数据是一位一位单独传输的，传输效率低，而且容易出现数据传输差错，通过数据链路层把数据进行封装成以帧为单位进行传输，可以提高传输效率，而且还能做数据传输差错控制。
	
	5. 与物理层的区别<br>
		物理层和数据链路层的本质作用都是用来构建网络通信、访问通道，但它们所建立的通信通道是不一样的。在物理层上构建的是物理链路，在数据链路层上构建的是逻辑链路或者数据链路。

	6. 数据帧头部会放源MAC地址和目标MAC地址

2. 链路层基本需要实现的功能
	1. 数据链路管理<br>
		**TODO**
	
	2. 封装成帧<br>
		在网络层传输的包（packet，又称分组），放在数据链路层中传输的是“帧”(frame)。数据包到达数据链路层后加上数据链路层的协议头和协议尾就构成了一个数据帧。在每个帧的前部加上一个帧头部，在帧的结尾处加上一个帧尾部，把网络层的数据包作为帧的数据部分，就构成了一个完整帧。帧头和帧尾就是作为帧的起始和结束标志，也就是帧边界
		<br>
		<img src="https://github.com/yinfork/Android-Interview/blob/master/res/network/data_link_frame.png?raw=true" width = "300px" height = "300px" />
		
		<br><br>
		**帧边界**<br>
		帧的数据部分的上限 <= MTU（最大传输单元）<br>
		MTU指帧中数据部分但不包括帧头和帧尾部分，同时，帧还有最小大小限制，如果封装的 IP 包小于最小帧要求时，就要用一些特殊字符进行填充
		
	3. 透明传输<br>
		指要使在数据链路层上所传输的数据在内容、格式及编码上都没有限制，也就是要使一些本来用于特殊用途的控制字符也能像正常的数据一样传输
		
	4. 差错控制
		1. 概念<br>
			为保证数据的正确传输。要实现差错控制须具备两种能力：
			1. 发现差错的能力
			2. 纠正错误的能力；
		2. 差错检测	<br>
			在数据链路层检测数据传输错误的方法-~般是通过对差错编码进行校验来实现，常见的校验方法有：
			1. 奇偶校验码(PPC)<br>
				1. 思想<br>
					原信息代码的最后添加一位用于奇校验或偶校验的代码,根据被传输的一组二进制代码的数位中“1”的个数是奇数或偶数来进行校验的。采用“1”的奇数个校验的方法称为奇校验，反之称为偶校验
				2. 缺点<br>
					奇偶校验方法只可以用来检査单个码元错误,检错能力较差,所以一般只用于本身误码率较低的环境,如用于以太局域网中、用于磁盘的数据存储中等
				
			2. 循环冗余校验(CRC)
				1. 思想<br>
					先在要发送的帧后面附加一个数，这个附加的数不是随意的，它要使加上这个数后所生成的新帧能与发送端和接收端共同选定的某个特定数整除（采用模2除法）。<br>
					到达接收端后，再把接收到的新帧除以（同样采用模2除法）这个选定的除数。因为在发送端发送数据帧之前就已附加了一个数，做了去余处理（也就已经能整除了），所以结果应该没有余数。如果有余数，则表明该帧在传输过程中出现了差错。
				2. 模2除法<br>
					与算术除法类似、但它既不向上位借位，也不比较除数和被除数的相同位数值的大小，只以相同位数进行相除。
				3. CRC校验码的计算示例<br>
					**TODO**<br>
					可参考：https://zhuanlan.zhihu.com/p/52665008
		3. 差错纠正<br>	
			**TODO**<br>
			可参考：https://zhuanlan.zhihu.com/p/52665008


3. 协议
	1. 点对点协议PPP<br>
		PPP是数据链路层使用最多的一种协议，它的特点是：简单，只检测差错而不去纠正差错，不使用序号，也不进行流量控制，可同时支持多种网络层协议。如我们在使用 Modem 进行拨号连接时就需要用到它，路由器设备间的 Serial 口之间的连接也要封装这个协议
	2. PPPoE是为宽带上网的主机使用的链路层协议

4. 网络设备
	1. 计算机网卡
	2. 网桥
	3. 二层交换机（注意是二层）

5. 参考
	1. https://zhuanlan.zhihu.com/p/52665008
	2. https://github.com/it-interview/EasyJob/blob/master/Network/network.md
	3. https://github.com/Snailclimb/JavaGuide/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%8E%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.md#%E5%85%AB-http%E9%95%BF%E8%BF%9E%E6%8E%A5%E3%80%81%E7%9F%AD%E8%BF%9E%E6%8E%A5 

----

<span id = "network_network_layer"></span>
#### 网络层 [(TOP)](#home)
1. 概述
	1. 作用<br>
		计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。网络层的任务就是选择合适的网间路由和交换结点，确保数据及时传送。
	
	2. 数据单位<br>
		分组和包。在 TCP/IP 体系结构中，由于网络层使用 IP 协议，因此分组也叫 IP 数据报 ，简称 数据报。

2. IP地址
	1. IP地址的表示
		IPv4的情况，IP地址是一个32位的二进制标识符<br>
		三种IP地址的表示：
		1. 分类IP地址
		2. 划分子网
		3. 构造超网

3. 分类的IP地址<br>
	1. 介绍<br>
 		分类的IP地址是指将固定的IP地址划分为若干个固定的类，每一类都有两个固定长度的字段组成。<br>
		IP地址::={<网络号>,<主机号>} 
		1. 其中第一个字段是网络号，标志着主机（路由器）所连接的网络，网络号是全网唯一的；
		2. 第二个字段是主机号，标志网络号所指的网络内的主机（路由器）。
	
	2. 分类<br>
		分类的IP地址根据网络号所占比特位个数不同，分为5类：A类、B类、C类、D类、E类，其中A、B、C类为单播地址，D类为多播地址，E类为保留地址。<br>
 		![](https://github.com/yinfork/Android-Interview/blob/master/res/network/network_ip_type.png?raw=true)
		1. A类IP地址
			1. 网络号<br>
				A类地址的网络号字段占1个字节，但前面的1位(0)已经固定，只剩下7位可以进行分配，即可指派的网络号是126个(即2^7-2)。<br>
				减去2是因为：
				1. 网络号字段为全0的IP地址是个保留地址，意思是“本网络”；
				2. 网络号为127(即01111111)保留作为本地软件环回测试(loopback test)本主机的进程之间的通信只用。
			
			2. 主机号<br>
			 	A类地址的主机号占3个字节，因此每一个A类网络中的最大主机数是2^24-2，即16777214。<br>
				减去2是因为：
				1. **全0的主机号字段表示该IP地址是“本主机”所连接到的单个网络地址(例如，一主机的IP地址为5.6.7.8，则该主机所在的网络地址就是5.0.0.0)。**
				2. **全1的主机号字段表示该IP地址是“所有的”，即该网络上的所有主机。**
			 
		2. B类IP地址
			1. 网络号<br>
				B类地址的网络号字段占2个字节，但前面的2位(1 0)已经固定，只剩下14位可以进行分配。因为128.0.0.0是保留地址，所以指派的B类最小网络地址是128.1.0.0，可指派的网络数是2^14-1，即16383。
				
			2. 主机号<br>
				B类地址的主机号占2个字节，每一个网络上的最大主机数是2^16-2，即65534，这里需要减2是因为要扣除全0和全1的主机号。 
			
		3. C类IP地址	
			1. 网络号<br>
				C类地址的网络号字段占3个字节，但前面的3位(11 0)已经固定，只剩下21位可以进行分配。因为192.0.0.0是不指派的，而可以指派的C类最小网络地址是192.0.1.0。因此C类地址可指派的网络数是2^21-1，即2097151
			2. 主机号<br>
				C类地址的每一个网络上的最大主机数是2^8-2，即254，这里需要减2是因为要扣除全0和全1的主机号。
	
	3. IP地址分类的原因<br>
		各种网络差异很大，有些网络拥有很多主机，有些网络拥有的主机相对较少，把IP地址划分为A类、B类、C类能更好的满足需求，当某个单位申请了一个IP地址时，实际是获得了同样网络号的一个IP地址块，其中的各台主机号则由单位自行分配。	
		
	4. IP地址分的缺点<br>
		1. IP地址空间的利用率有时候很低，地址浪费大<br>
			A类拥有超过65535台主机；B类拥有介于255~65535台主机；C类拥有小于255台主机<br>
			只有两、三台主机的网络，也至少要一个C类IP地址;A、B类浪费更严重，少有达上万台主机的大型IP网络。
		2. 路由表太大，影响网络性能<br>	
 			路由器需要能够从路由表中找出怎样到达其他网络的下一跳地址，而一个物理网络对应一个网络号，如果网络越多，则路由表越大，路由器的存储空间就需要越大，查找也更耗时。<br>
 			解决方法：使用构造超网，则能减少网络数，提升性能。
		3. 不够灵活<br>	
 			企业有很多部门，每个部门可能需要各自独立的网络，这怎么办呢？再申请网络？可是人数又不多，怎么办呢？<br>
 			解决方法：划分子网，而且便于管理。
 			
3. 划分子网 
	1. 概念<br>
		划分子网是指将IP类网划分为若干个子网。一般是从网络的主机号用若干位作为子网号（当然用来分配的主机号就相应减少），于是二级网络便成了三级网络。<br>
	<img src="https://github.com/yinfork/Android-Interview/blob/master/res/network/network_subnet.png?raw=true" width = "255px" height = "63px" /> <br>
 		划分子网后，发送到子网某台主机的IP数据报，仍是根据IP数据报的目的网络号找到连接到路由器，然后路由器根据IP数据报的目的网络号和子网号找到子网，再把IP数据报交付主机。<br>
 		划分子网后，ip地址的网络号是不变的，因此在局域网外部看来，这里仍然只存在一个网络，即网络号所代表的那个网络；但在网络内部却是另外一个景象，因为我们每个子网的子网号是不同的，当用化分子网后的ip地址与子网掩码做'与'运算时，每个子网将得到不同的子网地址，从而实现了对网络的划分。
	
	2. 子网掩码<br>
		1. 概念<br>
	 		子网掩码是一个应用于TCP/IP网络的32位二进制值，它可以屏蔽掉ip地址中的一部分，从而分离出ip地址中的网络部分与主机部分，基于子网掩码，管理员可以将网络进一步划分为若干子网。
		2. 为什么需要子网掩码<br>
	 		IP数据报中是没有子网的相关信息，这时可以通过将本机的子网掩码与接受方主机的ip地址进行'与'运算，即可得到目标主机所在的网络号，又由于每台主机在配置TCP/IP协议时都设置了一个本机ip地址与子网掩码，所以可以知道本机所在的网络号。<br>
	 		通过比较这两个网络号，就可以知道接受方主机是否在本网络上。如果网络号相同，表明接受方在本网络上，那么可以通过相关的协议把数据包直接发送到目标主机；如果网络号不同，表明目标主机在远程网络上，那么数据包将会发送给本网络上的路由器，由路由器将数据包发送到其他网络，直至到达目的地。
	 		
		3. 子网掩码得到网络/主机地址的计算	
			1. 将ip地址与子网掩码转换成二进制；
			2. 将二进制形式的ip地址与子网掩码做'与'运算，将答案化为十进制便得到网络地址；
			3. 将二进制形式的子网掩码取'反'；
			4. 将取'反'后的子网掩码与ip地址做'与'运算，将答案化为十进制便得到主机地址。
			5. 例子<br>
				假设有一个IP 地址：192.168.0.1<br>
				子网掩码为：255.255.255.0<br>
				化为二进制为：IP地址11000000.10101000.00000000.00000001<br>
				子网掩码11111111.11111111.11111111.00000000<br>
				将两者做'与'运算得：11000000.10101000.00000000.00000000<br>
				将其化为十进制得：192.168.0.0<br>
				这便是上面ip的网络地址，主机地址以此类推，得到主机地址是1
				
		4. 子网掩码的分类
			1. 缺省子网掩码<br>
				即未划分子网，对应的网络号的位都置1，主机号都置0。
				1. A类网络缺省子网掩码：255.0.0.0
				2. B类网络缺省子网掩码：255.255.0.0
				3. C类网络缺省子网掩码：255.255.255.0
			2. 自定义子网掩码<br>	
	 			将主机号分为两个部分：子网号、子网主机号。
				1. 未做子网划分的ip地址：网络号＋主机号
				2. 做子网划分后的ip地址：网络号＋子网号＋子网主机号

	3. 划分子网的利弊
		1. 好处
			1. 划分子网一个最为重要意义就在于减少广播所带来的负面影响，提高性能的整体性能。因为广播数据包只能在同一网段中传输，网络规模小了，网络中用户数少了，当然所占用的资源也就少了。
			2. 节省了IP地址资源
			3. 由于不同子网之间是不能直接通信的（但可通过路由器或网关进行），在网络安全形势不容乐观的今天，网络越小，安全性就相对越高，因为入侵的途经小了。
			4. 便于维护 
		2. 缺点
			1. 可连接的主机数减少。
			2. 至于各子网间不能直接通信，可以说是既是它的利，又是它的害，会带来诸多的不便。
	
4. 无分类编址CIDR（构造超网）
	1. 出现背景<br>
		对于A、B类地址，很少有这么大规模的公司能够使用，而C类地址所容纳的主机数又相对太少。所以有类别的IP地址并不利于有效地分配有限的地址空间，不适用于网络规划。<br>
		在这种情况下，人们开始致力于下一代因特网协议——IPv6的研究。由于现在IPv6的协议并不完善和成熟，需要长期的试验验证，因此，IPv4到IPv6的完全过渡将是一个比较长的过程，在过渡期间我们仍然需要在IPv4上实现网络间的互连。所以引入了变长子网掩码（VLSM）和无类域间路由（CIDR）等机制，作为目前过渡时期提高IPv4地址空间使用效率的短期解决方案起到了很大的作用。
	
	2. 解决的问题
		1. 大小比较适中的B类IP地址的严重匮乏。
		2. 因特网主干网上的路由表中的项目数急剧增长。
		3. Ipv4地址迟早被分配完，到时候再无IP地址可以分配。
	
	3. 实现原理
		1. 消除传统的A，B，C地址和划分子网的概念，更有效的分配IPv4的地址空间，CIDR使IP地址又回到无分类的两级编码。记法：IP地址::={<<网络前缀>，<<主机号>}。CIDR还使用“斜线记法”即在IP地址后面加上“/”然后写网络前缀所占的位数（192.198.80.72/22）
		2. CIDR把网络前缀都相同的连续IP地址组成一个“CIDR地址块”，即强化路由聚合（构成超网）。一个CIDR地址块中有很多地址，所以在路由表中就利用CIDR地址块来查找目的网络。这种地址的聚合常称为路由聚合，它是的路由表中的一个项目可以表示原来传统分类地址的很多个理由。路由聚合也称为构成超网。路由聚合有利于减少路由器之间的路由选择信息的交换，从而提高了整个因特网的性能。
	
	4. 与划分子网的区别
		1. 子网是把网络拆分，而超网则是把网络聚合。
		2. 为了更方便地进行路由选择，CIDR使用32位的地址掩码。地址掩码是一串1和一串0组成，而1的个数就是网络前缀的长度。虽然CIDR不使用子网了，但由于目前仍有一些网络还使用子网划分和子网掩码，因此CIDR使用的地址掩码也可以继续称为子网掩码。斜线记法中，斜线后面的数字就是地址掩码中1的个数。 
	
	5. 构成超网的几个规则
		1. 构成超网的地址块数必须是2的N（N＝1、2、3……)次幂。
		2. 构成超网的地址块（超块）必须是连续的地址块。
		3. 超块的第一个地址的第三字节必须能够被块数均匀的分开（开始地址必须能被地址数N整除）

6. 交换机、网关与路由器<br>
	1. 交换机<br>
		1. 原理<br>
			交换机拥有一条很高带宽的背部总线和内部交换矩阵。交换机的所有的端口都挂接在这条背部总线上，控制电路收到数据包以后，处理端口会查找内存中的MAC地址对照表以确定目的MAC（网卡的硬件地址）的NIC（网卡）挂接在哪个端口上，通过内部交换矩阵迅速将数据包传送到目的端口，目的MAC若不存在，广播到所有的端口，接收端口回应后交换机会“学习”新的MAC地址，并把它添加入内部MAC地址表中。
		2. 大多数交换机工作于OSI参考模型的第二层，即数据链路层。
		3. 只是对数据转发和过滤，不会重新打包数据
	
	2. 	网关
		1. 网关在网络层以上实现网络互连
		2. 与网桥只是简单地传达信息不同，网关对收到的信息要重新打包，以适应目的系统的需求 
		3. **TODO:RIP协议、端口映射**
		4. TODO：了解网关和默认网关
		
	3. 默认网关<br>
		默认网关事实上不是一个产品而是一个网络层的概念，PC本身不具备路由寻址能力，所以PC要把所有的IP包发送到一个默认的中转地址上面进行转发，也就是默认网关。<br>
		在主机的网络属性配置中，除了有自身的逻辑IP地址，还有默认的网关地址。默认网关地址就是用来不同网络之间的主机进行通信的一扇门。只有通过默认网关，主机的数据包才能够被发送到不同网络的主机中。<br>
		这个默认网关可以在路由器上，可以在三层交换机上，可以在防火墙上，可以在服务器上，所以和物理的设备无关。
		
	4. 路由器<br>
		提供了路由与转送两种重要机制
		1. 可以决定数据包从来源端到目的端所经过的路由路径（host到host之间的传输路径），这个过程称为路由；
		2. 将路由器输入端的数据包移送至适当的路由器输出端(在路由器内部进行)，这称为转送	
	5. 区别<br>
		**TODO**

7. 路由转发基本流程<br>
	![](https://github.com/yinfork/Android-Interview/blob/master/res/network/ip_route_demo.png?raw=true)<br>
	假设主机甲要跟主机乙进行通信，那么主机甲如何才能够找到主机乙的位置？
	1. 当用户在主机甲上输入PING 172.168.80.8之后，主机甲中有一个网际控制报文协议ICMP。这个协议将创建一个回应请求数据包，在它的数据域中只包含有字母。
	2. 网际控制报文协议会将这个有效负荷(即刚创建的数据包)交给网际协议IP。<br>
		这个网际协议也会创建一个数据包。在这个网际协议IP创建的数据包中，在这个包中包括主机甲的IP地址、目的地主机已的IP地址以及值为01h的协议字段。当数据包到达主机乙时，这些内容就是告诉对方，应该将这个有效负荷交给网际控制报文协议来处理。
	3. IP协议会判断目的IP地址是属于远程网络，还是在本地网络。<br>
		由于根据IP地址规划规则，主机甲与主机乙属于不同的网络。此时，刚才网际协议IP所创建的数据包将会被发送到默认的网关中去。<br>
		在主机甲的网络属性配置中，除了有自身的逻辑IP地址，还有默认的网关地址。网关地址就是用来不同网络之间的主机进行通信的一扇门。只有通过网关，主机甲的数据包才能够被发送到不同网络的主机乙中。
	4. 确认路由器相应接口的MAC地址<br>
		假设主机甲(IP地址为172.168.60.6)的默认网关被配置为172.168.60.1。若主机甲的数据包要发送到这个默认网关上，则就必须知道其对应的路由器接口的物理地址，即MAC地址。得到目标IP的MAC地址后，数据包将会被释放并传递到数据链路层并生成帧。其中目的方的硬件地址也将同数据包一起下传到数据链路层。<br>
		当主机甲要把数据包发送给特定的网关时，必须要知道这个网关所对应的MAC地址。以下是简要的ARP过程：
		1. 主机甲首先会检查自己的ARP缓存，查看一个默认网关的IP地址是否已经解析为对应接口的硬件地址。
		2. 如果不存在，则将ARP请求帧广播到本地网络上的所有主机。
		3. 本地网络上的每台主机都接收到ARP请求并且检查是否与自己的IP地址匹配
		4. 如果匹配，则目标主机将包含其MAC地址的ARP回复消息直接发送回主机甲。
		5. 当主机甲收到从目标主机发来的ARP回复消息时，会用主机B的IP和MAC地址映射更新ARP缓存。		
	
	5. 生成帧<br>
		当这个数据包和目的方的硬件地址被传递给数据链路层之后，一个数据帧即将产生，一旦完成帧的封装，则这个帧将会被交付到物理层。在这个帧中，主要包括:
		1. 目的MAC地址<br>
			这里指的目的地址并不是主机乙的地址，而是里主机甲最近的默认网关地址。在第一次通信时，主机甲并不知道主机乙的MAC地址。
		2. 源MAC地址(主机甲的MAC地址)
		3. 以太网类型字段<br>
			这个以太网类型字段主要用来描述的是交付这个数据包到数据链路层的网络层协议
		4. 数据包
		5. 帧校验序列<br>
			装载循环冗余校验计算值的区域
	6. 发送和接受帧
		1. 在主机甲所在的冲突域中的每台网络设备都将接收这些位并重新合并成数据帧。（冲突域是在同一个网络上两个设备同时进行传输则会产生冲突；冲突域就是连接在同一导线上的所有工作站的集合）
		2. 接收完毕后，他们会运行CRC过程并核对保存在帧校验序列字段中的内容。
		3. 如果这两个值不匹配的话，则这个帧将会被丢弃。如果两个值相同，则网络设备会接收这个帧，并核查目的方的硬件地址，检查他们是否也匹配。
		4. 如果目的方的硬件地址也是匹配的，那么路由器将会查看这个帧的以太网类型字段，以了解在网络层上采用了什么协议
		5. 然后路由器就会抽出帧中的数据包，把其余部分内容丢弃。然后把抽出来的数据包传送给以太网类型字段中列出的上层协议，如网际协议IP等等。
	7. 判断路由表项目。<br>
		网际协议IP会接收这个数据包，并检查目的IP地址。在这个案例中，由于数据包中的目的地址与接收路由器所配置的任何地址都不相匹配。此时，路由器就会在自己的路由表（**在路由表中，对每一条路由最主要的是以下两个信息：目的网络地址，下一跳地址**）中，查看目的IP的网络地址。在这个案例中，由于路由器同时连接着172.16.80.0的网络。所以在这个路由器的路由表中，有相关的纪录。若没有记录的话，则这个数据包会被直接丢弃。若路由器丢弃数据包的话，则会发送一个“目标地址不可达”的错误信息给主机甲。
	8. 路由器转发数据包<br>
		如果路由器的确在他的路由表中找到了相应网络的记录，则数据包就会被转发到输出接口。在本例中，就是主机乙所连接的接口。路由器会将这个数据包交换到对应接口的缓冲区内。
	9. 确认主机乙的MAC地址<br>
		路由器对应接口的缓冲区需要了解目的方主机的硬件地址。参考第四步，通过ARP缓存或者ARP请求获取主机乙的MAC地址。<br>
		路由器知道目的主机乙的MAC地址之后，就会把数据包连同目的方的MAC地址传递到下一层的数据链路中。
	10. 路由器会重复上面的第五步操作，生成数据帧。并传送到物理层，以一次一位的方式再发送到物理媒体上。在网络中进行传输。
	11. 主机乙会接收数据并响应ICMP协议<br>
		1. 主机乙会接收到这个数据帧并运行CRC过程
		2. 如果运算结果与帧校验序列中字段的内容相同，则这个帧中目的方的MAC地址将会被读取
		3. 主机乙会判断这个MAC地址是否跟自己的MAC地址相同
		4. 若相同的话，则会抽取其中的数据包，并根据以太网字段类型中指定的协议，把数据包传递给相应的协议处理
		5. 由于这个是ICMP协议的数据包，所以交给ICMP协议处理。ICMP协议会应答这个请求，同时把这个数据包丢弃并迅速生成一个新的有效负荷来作为回应应答。
		6. 主机乙会利用同样的过程把数据包以及目的MAC地址(路由器对应接口的物理地址)传递到下一层，让其生成帧。<br>
			在数据帧上，会带有目的MAC地址、源MAC地址、数据包、以太网字段类型、帧校验序列字段等内容发送到下一层。然后再一位位的传送到物理媒体
	12. 路由器再重复第六步到第十步的过程，把数据包从一个接口交换传递到另一个接口中。然后主机甲就收到一个回应信息，表示到主机乙的道路是通的。		
	13. 小结
		1. 第一到五步主要都是在主机甲上完成。这五个步骤执行完毕之后，IP路由选择过过程的前期工作就算完成了。
		2. 第六到十步是网际协议IP路由选择的步骤。可以看出路由器的作用主要就是进行数据交换。把其收到的数据包根据一定的规则转发到另一个可达的接口上。<br>
			路由器就好像是一个十字路口，各个数据包都根据自己所需要到达的目的地，现在合适的出口。	
		
8. 各种路由
	1. 静态路由<br>
		指由网络管理员手工配置的路由信息。当网络的拓扑结构或链路的状态发生变化时，网络管理员需要手工去修改路由表中相关的静态路由信息。静态路由信息在缺省情况下是私有的，不会传递给其他的路由器，但也可以设置使之成为共享的。<br>
		静态路由一般适用于比较简单的网络环境，在这样的环境中，网络管理员易于清楚地了解网络的拓扑结构，便于设置正确的路由信息。
	2. 动态路由<br>
		是指路由器能够自动地建立自己的路由表，并且能够根据实际实际情况的变化适时地进行调整。动态路由机制的运作依赖路由器的两个基本功能：对路由表的维护；路由器之间适时的路由信息交换。
	3. 特定主机路由<br>
		即对特定的目的主机指明的一个路由。这种路由叫做特定主机路由。<br>
		采用特定主机路由的好处：
		1. 可使网络管理人员能够更方便地控制网络和测试网络，同时也可在需要考虑某种安全问题时采用这种特定主机路由。
		2. 在对网络的连接或路由表进行排错时，指明到某一主机的特定路由就十分有用。
	
	4. 默认路由<br>
		默认路由是一种特殊的静态路由，指的是当路由表中与包的目的地址之间没有匹配的表项时路由器能够做出的选择。<br>
		如果没有默认路由，那么目的地址在路由表中没有匹配表项的包将被丢弃。<br>
		默认路由在某些时候非常有效，当存在末梢网络时，默认路由会大大简化路由器的配置，减轻管理员的工作负担，提高网络性能。<br>
		主机里的默认路由通常被称作默认网关，默认网关通常会是一个有过滤功能的设备，如防火墙和代理服务器。
	
9. 分类IP路由分组转发算法
	1. 从数据报的首部提取目的主机的IP地址D，得出目的网络地址为N。
	2. 若N就是与此路由器直接相连的某个网络地址，则进行直接交付，不需要再经过其他的路由器，直接把数据报交付给目的主机（这里包括把目的主机地址D转换为具体的硬件地址，把数据报封装为MAC帧，再发送此帧）；否则就要执行(3)进行间接交付。
	3. 若路由表中有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器，否则执行(4)。
	4. 若路由表中有到达网络N的路由，则把数据报传送给路由表中所指明的下一跳路由器，否则执行(5)。
	5. 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的下一跳路由器，否则执行(6)。
	6. 报告转发分组出错。
		
10. 划分子网下的分组转发<br>
	**使用子网划分后，路由表必须包含以下三项内容：目的网络地址、子网掩码和下一跳地址。**<br>
在划分子网的情况下，路由转发分组的算法如下(和没划分子网的情况比较下，大体的流程是不变的)：
	1. 从收到的数据报的首部提取目的IP地址D。
	2. 先判断是否为直接交付。对路由器直接相连的网络逐个进行检查：用各网络的子网掩码和D逐位相“与”（AND操作），看结果是否和相应的网络地址匹配。若匹配，则把分组进行直接交付（还需把D转换成物理地址，把数据报封装成帧发送出去），转发任务结束。否则就是间接交付，执行（3）。
	3. 若路由表中有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行（4）。
	4. 对路由表中的每一行（目的网络地址、子网掩码、下一跳地址），用其中的子网掩码和D逐位相“与”（AND），其结果为N。若N与该行的目的网络地址匹配，则把数据报传送给该行指明的下一跳路由器；否则，执行（5）。
	5. 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行（6）。
	6. 报告转发分组出错。

11. 构造超网下的分组转发<br>
	在使用使CIDR时，由于采用了网络前缀这种记法，IP地址由网络前缀和主机号这两个部分组成，因此在路由表中的项目也要有相应的改变。这时，**路由表中的每个项目由“网络前缀”和“下一跳地址”组成。**<br>
	但是在查找路由表时可能会得到不止一个匹配结果。这个时候我们应当从匹配结果中**选择具有最长网络前缀的路由，这叫作最长前缀匹配。**即选择两个匹配结果中地址更具体的一个。<br>
	路由转发分组的算法和分类IP、划分子网的路由转发时差不多，只是第二步改成利用网络前缀来判断是否为直接交付

12. 配套的四个协议
	1. ARP（Address Resolution Protocol）地址解析协议<br>
		1. 作用：IP地址 -> MAC地址
		2. 过程：<br>
			当主机A的IP地址为192.168.1.1，MAC地址为0A-11-22-33-44-01；<br>
			主机B的IP地址为192.168.1.2，MAC地址为0A-11-22-33-44-02；<br>
			以下为工作流程：
			1. 根据主机A上的路由表内容，IP确定用于访问主机B的转发IP地址是192.168.1.2。然后A主机在自己的本地ARP缓存中检查主机B的匹配MAC地址。
			2. 如果主机A在ARP缓存中没有找到映射，它将询问192.168.1.2的硬件地址，从而将ARP请求帧广播到本地网络上的所有主机。源主机A的IP地址和MAC地址都包括在ARP请求中。本地网络上的每台主机都接收到ARP请求并且检查是否与自己的IP地址匹配。如果主机发现请求的IP地址与自己的IP地址不匹配，它将丢弃ARP请求。
			3. 主机B确定ARP请求中的IP地址与自己的IP地址匹配，则将主机A的IP地址和MAC地址映射添加到本地ARP缓存中。
			4. 主机B将包含其MAC地址的ARP回复消息直接发送回主机A。
			5. 当主机A收到从主机B发来的ARP回复消息时，会用主机B的IP和MAC地址映射更新ARP缓存。本机缓存是有生存期的，生存期结束后，将再次重复上面的过程。主机B的MAC地址一旦确定，主机A就能向主机B发送IP通信了。
		
	2. RARP（Reverse Address Resolution Protocol）逆地址解析协议（已经被淘汰）<br>
		MAC地址 -> IP地址	
	
	3. ICMP（Internet Control Message Protocol）因特网控制报文协议 <br>
		用于TCP/IP网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈，通过这些信息，令管理者可以对所发生的问题作出诊断，然后采取适当的措施解决。比如常见的Ping命令
	
	4. IGMP（Internet Group Management Protocol）因特网组管理协议<br>
		用于管理网路协议多播组成员的一种通信协议。IP主机和相邻的路由器利用IGMP来创建多播组的组成员。


13. IP数据报<br>
	![](https://github.com/yinfork/Android-Interview/blob/master/res/network/network_ip_data.png?raw=true)



14. 参考
	1. https://www.jianshu.com/p/155d4bfcdac1
	2. https://www.jianshu.com/p/1165bfc708c0
	3. https://www.jianshu.com/p/8c8c1d1f2344
	4. https://zhuanlan.zhihu.com/p/37820182
	5. https://zhuanlan.zhihu.com/p/26098552


		
----

<span id = "network_transport_layer"></span>
#### 运输层 [(TOP)](#home)
TODO

----

<span id = "network_application_layer"></span>
#### 应用层 [(TOP)](#home)
1. 定义<br>
	通过应用进程间的交互来完成特定网络应用。应用层协议定义的是应用进程（进程：主机中正在运行的程序）间的通信和交互的规则。

2. 常见协议
	1. Http
	2. DNS 

3. Http协议详解



