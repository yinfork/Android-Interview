## 计算机基础
<span id = "home"></span>
#### 目录
1. [IO操作](#computer_io)

----

<span id = "computer_io"></span>
#### IO操作 [(TOP)](#home)
1. 传统的标准IO操作<br>
	1. 介绍<br>
		传统的 Linux 操作系统的标准 I/O 接口是基于数据拷贝操作的，即 I/O 操作会导致数据在操作系统内核地址空间的缓冲区和应用程序地址空间定义的缓冲区之间进行传输。这样做最大的好处是可以减少磁盘 I/O 的操作，因为如果所请求的数据已经存放在操作系统的高速缓冲存储器中，那么就不需要再进行实际的物理磁盘 I/O 操作。但是数据传输过程中的数据拷贝操作却导致了极大的 CPU 开销，限制了操作系统有效进行数据传输操作的能力。
	
	2. Linux中传统服务器进行数据传输的流程<br>
		![](https://github.com/yinfork/Android-Interview/blob/master/res/computer/io_read_write.png?raw=true)
		1. 当应用程序需要访问某块数据的时候，操作系统内核会先检查这块数据是不是因为前一次对相同文件的访问而已经被存放在操作系统内核地址空间的缓冲区内
		2. 如果在内核缓冲区中找不到这块数据，Linux 操作系统内核会先将这块数据从磁盘读出来放到操作系统内核的缓冲区里去。如果这个数据读取操作是由 DMA 完成的，那么在 DMA 进行数据读取的这一过程中，**CPU只是需要进行缓冲区管理，以及创建和处理 DMA** ，除此之外，CPU 不需要再做更多的事情
		3. DMA 执行完数据读取操作之后，会通知操作系统做进一步的处理。
		4. Linux 操作系统会根据 read() 系统调用指定的应用程序地址空间的地址，把这块数据存放到请求这块数据的应用程序的地址空间中去
		5. 在接下来的处理过程中，操作系统需要将数据再一次从用户应用程序地址空间的缓冲区拷贝到与网络堆栈相关的内核缓冲区中去，这个过程也是**需要占用 CPU 的**。
		6. 数据拷贝操作结束以后，数据会被打包，然后发送到网络接口卡上去。在数据传输的过程中，应用程序可以先返回进而执行其他的操作。
		7. 之后，在调用 write() 系统调用的时候，用户应用程序缓冲区中的数据内容可以被安全的丢弃或者更改，因为操作系统已经在内核缓冲区中保留了一份数据拷贝，当数据被成功传送到硬件上之后，这份数据拷贝就可以被丢弃。

2. DMA介绍<br>
**TODO**

3. 零拷贝技术
	1. 介绍
		零拷贝就是一种避免 CPU 将数据从一块存储拷贝到另外一块存储的技术。零拷贝技术可以减少数据拷贝和共享总线操作的次数，消除传输数据在存储器之间不必要的中间拷贝次数，从而有效地提高数据传输效率。而且，零拷贝技术减少了用户应用程序地址空间和操作系统内核地址空间之间因为上下文切换而带来的开销。
	2. 零拷贝技术分类	
		1. 直接 I/O<br>
			对于这种数据传输方式来说，应用程序可以直接访问硬件存储，操作系统内核只是辅助数据传输：这类零拷贝技术针对的是操作系统内核并不需要对数据进行直接处理的情况，数据可以在应用程序地址空间的缓冲区和磁盘之间直接进行传输，完全不需要 Linux 操作系统内核提供的页缓存的支持。
		2. 在数据传输的过程中，避免数据在操作系统内核地址空间的缓冲区和用户应用程序地址空间的缓冲区之间进行拷贝。<br>
			有的时候，应用程序在数据进行传输的过程中不需要对数据进行访问，那么，将数据从 Linux 的页缓存拷贝到用户进程的缓冲区中就可以完全避免，传输的数据在页缓存中就可以得到处理。在某些特殊的情况下，这种零拷贝技术可以获得较好的性能。Linux 中提供类似的系统调用主要有 mmap()，sendfile() 以及 splice()。
		3. 对数据在 Linux 的页缓存和用户进程的缓冲区之间的传输过程进行优化。<br>
			该零拷贝技术侧重于灵活地处理数据在用户进程的缓冲区和操作系统的页缓存之间的拷贝操作。这种方法延续了传统的通信方式，但是更加灵活。在 Linux 中，该方法主要利用了写时复制技术。
	3. Java零拷贝技术的实现<br>
		TODO
	
4. 问题：IO操作对CPU的消耗是否多？

5. 参考
	1. https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy1/index.html
	2. https://www.ibm.com/developerworks/cn/linux/l-cn-zerocopy2/index.html
	3. https://www.zhihu.com/question/27734728


